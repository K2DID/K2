<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Parade State Compiler</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; font-size: 16px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    th { background-color: #f2f2f2; }
    input[type=text] { width: 50%; padding: 4px; font-size: 15px; }
    input[type=checkbox] { transform: scale(1.2); }
    textarea { width: 100%; height: 200px; margin-top: 10px; font-size: 15px; }
    button { padding: 8px 12px; font-size: 16px; margin-top: 5px; }
</style>
</head>
<body>

<h2>Parade State Compiler</h2>

<form id="attendanceForm">
    <div id="branches"></div>
    <button type="button" onclick="calculateAttendance()">Generate Report</button>
</form>
<hr>
<h3>Parade State</h3>
<textarea id="output" readonly></textarea><br>
<button type="button" onclick="copyToClipboard()">Copy</button>

<script>
// Branch data
const BRANCHES = {
    "A Br": ["TW"],
    "B Br": ["KT", "SK", "ES", "TL"],
    "C Br": ["ZY", "WJ", "WZ", "SW", "AO"],
    "IDB ": ["IL", "MT"],
    "DRB ": ["WY", "Cx"],
    "DSB ": ["VO", "FL", "JY"]
};

const container = document.getElementById("branches");

// Generate tables
for (let branch in BRANCHES) {
    let table = `<h3>${branch}</h3><table><tr><th>Name</th><th>Present?</th><th>Excuse</th></tr>`;
    BRANCHES[branch].forEach(name => {
        table += `<tr>
                    <td>${name}</td>
                    <td width="50" style="text-align:center;"><input type="checkbox" name="${branch}__${name}__present"></td>
                    <td><input type="text" name="${branch}__${name}" placeholder="MC, leave, etc."></td>
                  </tr>`;
    });
    table += "</table>";
    container.innerHTML += table;
}

function formatDate() {
    const date = new Date();
    const options = { day: 'numeric', month: 'short', year: '2-digit' };
    return date.toLocaleDateString('en-GB', options).replace(/ /g, ' ');
}

function calculateAttendance() {
    //let output = `Parade State for ${formatDate()}\n\n`;
    let output = `\n`;
    let totalPresent = 0;
    let totalPeople = 0;

    for (let branch in BRANCHES) {
        let members = BRANCHES[branch];
        let absentees = [];
        let presentCount = 0;

        members.forEach(name => {
            let val = document.querySelector(`[name='${branch}__${name}']`).value.trim();
            let isPresentChecked = document.querySelector(`[name='${branch}__${name}__present']`).checked;

            // Rule logic:
            if (!isPresentChecked && !val) {
                // Present: no tick, no text
                presentCount++;
            } 
            else if (!isPresentChecked && val) {
                // Absent: only text
                absentees.push(`${name} (${val})`);
            } 
            else if (isPresentChecked && val) {
                // Present but with excuse
                presentCount++;
                absentees.push(`${name} (${val})`);
            } 
            else if (isPresentChecked && !val) {
                // Present: tick only
                presentCount++;
            }
        });

        totalPresent += presentCount;
        totalPeople += members.length;

        output += `${branch}: ${presentCount}/${members.length}\n`;
        if (absentees.length > 0) {
            output += `- _${absentees.join(", ")}_\n`;
        }
        output += "\n";
    }

    output = `*Parade State for ${formatDate()}*\n\nTOTAL: ${totalPresent}/${totalPeople}\n\n` + output;
    document.getElementById("output").value = output.trim();
}

function copyToClipboard() {
    const textarea = document.getElementById("output");
    textarea.select();
    textarea.setSelectionRange(0, 99999); // For mobile
    navigator.clipboard.writeText(textarea.value).then(() => {
        alert("Copied to clipboard!");
    });
}
</script>

</body>
</html>


